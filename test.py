import streamlit as st
from typing import Dict, List
import random

# ------------------------------
# í˜ì´ì§€ ì„¤ì •
# ------------------------------
st.set_page_config(
    page_title="ë…ì„œ ì„±í–¥ ê¸°ë°˜ ì±… ì¶”ì²œ",
    page_icon="ğŸ“–âœ¨",
    layout="wide"
)

# ------------------------------
# CSS + í°íŠ¸ + ë°°ê²½ìŒì•…
# ------------------------------
st.markdown("""
<style>
/* ì „ì²´ ë°°ê²½ */
.stApp {
    background-color: #26365c;
    font-family: 'Arial Rounded MT Bold', 'Helvetica Rounded', 'Pretendard', sans-serif;
}

/* ì¼ë°˜ í…ìŠ¤íŠ¸ëŠ” í°ìƒ‰ */
.stApp, .stMarkdown, h1, h2, h3, h4, h5, h6, p, label {
    color: #ffffff !important;
}

/* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
.card {
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: 1rem;
    background-color: rgba(255,255,255,0.08);
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    color: #ffffff !important;
}

/* ë²„íŠ¼ */
.stButton > button {
    background-color: #445;
    color: #ffffff !important;
    border-radius: 12px;
    padding: 0.6rem 1.2rem;
    border: none;
    font-weight: bold;
    transition: 0.3s;
}
.stButton > button:hover {
    background-color: #667;
    transform: scale(1.05);
}

/* ë¼ë””ì˜¤/ì…€ë ‰íŠ¸ë°•ìŠ¤ í•­ëª© ìƒ‰ìƒ */
.stRadio > label, .stSelectbox > div, .stCheckbox > label {
    color: #ffffff !important;
}

/* ===== ì…ë ¥ì°½ ë‚´ë¶€ ê¸€ì/ë©”ë‰´ ê¸€ì (ê²€ì •ìƒ‰) ===== */
input, textarea, select, .stTextInput input, .stSelectbox div[data-baseweb="select"] * {
    color: #000000 !important;
}

/* ì‚¬ì´ë“œë°” ë©”ë‰´ í…ìŠ¤íŠ¸ëŠ” ê²€ì • */
section[data-testid="stSidebar"] .stRadio label {
    color: #000000 !important;
}
</style>

<!-- ë°°ê²½ ìŒì•… (ë² í† ë²¤ ì›”ê´‘ ì†Œë‚˜íƒ€ 1ì•…ì¥) -->
<iframe width="0" height="0" src="https://www.youtube.com/embed/4Tr0otuiQuU?autoplay=1&loop=1&playlist=4Tr0otuiQuU" frameborder="0" allow="autoplay"></iframe>
""", unsafe_allow_html=True)

# ------------------------------
# ë°ì´í„° ì •ì˜
# ------------------------------
TYPES: Dict[str, str] = {
    "ê°ì„±ì  ëª°ì…í˜•": "ì‘í’ˆ ì† ë¶„ìœ„ê¸°ì™€ ê°ì •ì— ê¹Šì´ ë¹ ì ¸ë“œëŠ” íƒ€ì…",
    "ì§€ì  íƒêµ¬í˜•": "ìƒˆë¡œìš´ ì§€ì‹ê³¼ ê´€ì ì„ íƒêµ¬í•˜ëŠ” ê²ƒì„ ì¦ê¸°ëŠ” íƒ€ì…",
    "í˜„ì‹¤ ê³µê°í˜•": "í˜„ì‹¤ì ì¸ ë¬¸ì œì™€ ì‚¶ì— ê³µê°í•˜ëŠ” íƒ€ì…",
    "ëª¨í—˜ ì¶”êµ¬í˜•": "ìƒˆë¡œìš´ ì„¸ê³„ì™€ ìŠ¤í† ë¦¬ì— ì„¤ë ˆëŠ” íƒ€ì…",
    "íœ´ì‹ íë§í˜•": "ë§ˆìŒì„ í¸ì•ˆí•˜ê²Œ í•´ì£¼ëŠ” ê¸€ì„ ì„ í˜¸í•˜ëŠ” íƒ€ì…",
    "ì‚¬íšŒ ë¹„íŒí˜•": "ë¹„íŒì  ì‹œê°ìœ¼ë¡œ ì„¸ìƒì„ ì½ì–´ë‚´ëŠ” íƒ€ì…",
    "ìê¸° ì„±ì¥í˜•": "ìŠ¤ìŠ¤ë¡œë¥¼ ë°œì „ì‹œí‚¤ê³  ì„±ì°°í•˜ëŠ” íƒ€ì…",
    "ìœ ë¨¸ ìœ„ë¡œí˜•": "ì›ƒìŒê³¼ ê°€ë²¼ìš´ ìœ„ë¡œë¥¼ ì–»ëŠ” íƒ€ì…",
    "ì˜ˆìˆ  ê°ìƒí˜•": "ë¬¸ì²´, í‘œí˜„, ê°ê°ì ì¸ ì•„ë¦„ë‹¤ì›€ì— ì§‘ì¤‘í•˜ëŠ” íƒ€ì…",
    "ê´€ê³„ ì§€í–¥í˜•": "ì¸ê°„ê´€ê³„ì™€ ì†Œí†µ ì´ì•¼ê¸°ì— ëŒë¦¬ëŠ” íƒ€ì…",
}

BOOKS: Dict[str, List[str]] = {
    "ê°ì„±ì  ëª°ì…í˜•": ["ë‚˜ë¯¸ì•¼ ì¡í™”ì ì˜ ê¸°ì ", "ì—°ì• ì˜ ê¸°ì–µ", "ì²œ ê°œì˜ íŒŒë‘"],
    "ì§€ì  íƒêµ¬í˜•": ["ì‚¬í”¼ì—”ìŠ¤", "ì´ê· ì‡ ", "ì½”ìŠ¤ëª¨ìŠ¤"],
    "í˜„ì‹¤ ê³µê°í˜•": ["82ë…„ìƒ ê¹€ì§€ì˜", "ì•„ëª¬ë“œ", "ì™„ë“ì´"],
    "ëª¨í—˜ ì¶”êµ¬í˜•": ["í•´ë¦¬í¬í„° ì‹œë¦¬ì¦ˆ", "ë°˜ì§€ì˜ ì œì™•", "ì–¼ìŒê³¼ ë¶ˆì˜ ë…¸ë˜"],
    "íœ´ì‹ íë§í˜•": ["ê³°ëŒì´ í‘¸, í–‰ë³µí•œ ì¼ì€ ë§¤ì¼ ìˆì–´", "ì£½ê³  ì‹¶ì§€ë§Œ ë–¡ë³¶ì´ëŠ” ë¨¹ê³  ì‹¶ì–´", "í•˜ë£¨ 1ë¶„ ë§ˆìŒì±™ê¹€"],
    "ì‚¬íšŒ ë¹„íŒí˜•": ["ë©‹ì§„ ì‹ ì„¸ê³„", "1984", "ë™ë¬¼ ë†ì¥"],
    "ìê¸° ì„±ì¥í˜•": ["7ê°€ì§€ ìŠµê´€", "ì•„ì£¼ ì‘ì€ ìŠµê´€ì˜ í˜", "ë¯¸ë¼í´ ëª¨ë‹"],
    "ìœ ë¨¸ ìœ„ë¡œí˜•": ["ì•„ë¬´íŠ¼, ê°œê·¸", "ì •ì‹ ê³¼ ê°„í˜¸ì‚¬ì˜ ì›ƒìŒ ìƒë‹´ì‹¤", "ì›ƒìŒì€ ë³´ì•½ì´ë‹¤"],
    "ì˜ˆìˆ  ê°ìƒí˜•": ["ë°ë¯¸ì•ˆ", "ì¹´ë¼ë§ˆì¡°í”„ê°€ì˜ í˜•ì œë“¤", "ì¸ìƒ ë² ì´ì»¤ë¦¬"],
    "ê´€ê³„ ì§€í–¥í˜•": ["ì‘ë³„ì¸ì‚¬", "ì¸ê°„ ì‹¤ê²©", "ìš°ë¦¬ ì‚¬ì´ ì–´ì©Œë©´ ê´œì°®ì€"],
}

QUESTIONS = [
    ("ì±…ì„ ì½ì„ ë•Œ ê°€ì¥ ì¤‘ìš”í•œ ê²ƒì€?", ["ê°ì • ì´ì…", "ìƒˆë¡œìš´ ì§€ì‹", "í˜„ì‹¤ ê³µê°", "ëª¨í—˜ì‹¬"]),
    ("ì‰¬ëŠ” ë‚  ì½ê³  ì‹¶ì€ ì±…ì€?", ["íë§ ì—ì„¸ì´", "ì‚¬íšŒ ë¹„íŒì„œ", "ìê¸°ê³„ë°œì„œ", "ìœ ë¨¸ ì†Œì„¤"]),
    ("ì±…ì—ì„œ ê°€ì¥ ë§ˆìŒì´ ê°€ëŠ” ë¶€ë¶„ì€?", ["ë¬¸ì²´/ì˜ˆìˆ ì„±", "ì¸ê°„ê´€ê³„", "ìŠ¤í† ë¦¬ ëª°ì…ë„", "ë©”ì‹œì§€/ì‚¬ìƒ"]),
    ("ì¹œêµ¬ê°€ ì±…ì„ ì¶”ì²œí•´ë‹¬ë¼ê³  í•œë‹¤ë©´?", ["ê°ì„± ì†Œì„¤", "ì—­ì‚¬/ì² í•™", "ìê¸°ê³„ë°œ", "íŒíƒ€ì§€/ëª¨í—˜"]),
    ("ë‚˜ì—ê²Œ ë…ì„œëŠ”?", ["ì¹˜ìœ ", "íƒêµ¬", "ì¦ê±°ì›€", "ì„±ì¥"]),
]

# ------------------------------
# í•¨ìˆ˜ ì •ì˜
# ------------------------------
def run_quiz():
    st.header("ğŸ“– ì„±í–¥ í…ŒìŠ¤íŠ¸")
    scores = {t: 0 for t in TYPES}
    for q, options in QUESTIONS:
        answer = st.radio(q, options, key=q)
        if answer in ["ê°ì • ì´ì…", "ìŠ¤í† ë¦¬ ëª°ì…ë„", "ê°ì„± ì†Œì„¤"]:
            scores["ê°ì„±ì  ëª°ì…í˜•"] += 1
        elif answer in ["ìƒˆë¡œìš´ ì§€ì‹", "ì—­ì‚¬/ì² í•™", "íƒêµ¬"]:
            scores["ì§€ì  íƒêµ¬í˜•"] += 1
        elif answer in ["í˜„ì‹¤ ê³µê°"]:
            scores["í˜„ì‹¤ ê³µê°í˜•"] += 1
        elif answer in ["ëª¨í—˜ì‹¬", "íŒíƒ€ì§€/ëª¨í—˜"]:
            scores["ëª¨í—˜ ì¶”êµ¬í˜•"] += 1
        elif answer in ["íë§ ì—ì„¸ì´", "ì¹˜ìœ "]:
            scores["íœ´ì‹ íë§í˜•"] += 1
        elif answer in ["ì‚¬íšŒ ë¹„íŒì„œ", "ë©”ì‹œì§€/ì‚¬ìƒ"]:
            scores["ì‚¬íšŒ ë¹„íŒí˜•"] += 1
        elif answer in ["ìê¸°ê³„ë°œì„œ", "ì„±ì¥"]:
            scores["ìê¸° ì„±ì¥í˜•"] += 1
        elif answer in ["ìœ ë¨¸ ì†Œì„¤", "ì¦ê±°ì›€"]:
            scores["ìœ ë¨¸ ìœ„ë¡œí˜•"] += 1
        elif answer in ["ë¬¸ì²´/ì˜ˆìˆ ì„±"]:
            scores["ì˜ˆìˆ  ê°ìƒí˜•"] += 1
        elif answer in ["ì¸ê°„ê´€ê³„"]:
            scores["ê´€ê³„ ì§€í–¥í˜•"] += 1

    if st.button("ê²°ê³¼ ë³´ê¸° âœ¨"):
        top = sorted(scores.items(), key=lambda x: x[1], reverse=True)[:2]
        for t, _ in top:
            st.subheader(f"ğŸŒŸ {t}")
            st.write(TYPES[t])
            st.write("ì¶”ì²œ ë„ì„œ:", ", ".join(BOOKS[t]))

def run_recommend_by_genre():
    st.header("ğŸ“š ì¥ë¥´ë³„ ì¶”ì²œ")
    genre = st.selectbox("ê´€ì‹¬ ìˆëŠ” ì„±í–¥ì„ ì„ íƒí•˜ì„¸ìš”", list(BOOKS.keys()))
    st.subheader(f"âœ¨ {genre} ì¶”ì²œ ë„ì„œ")
    for book in BOOKS[genre]:
        st.markdown(f"<div class='card'>{book}</div>", unsafe_allow_html=True)

def run_free_input():
    st.header("ğŸ–Šï¸ ììœ  ì…ë ¥ ê¸°ë°˜ ì¶”ì²œ")
    keyword = st.text_input("ìµœê·¼ ì½ì€ ì±…ì´ë‚˜ ê´€ì‹¬ ìˆëŠ” í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”")
    if keyword:
        all_books = [b for books in BOOKS.values() for b in books]
        suggestions = random.sample(all_books, 3)
        st.write("ë‹¹ì‹ ì„ ìœ„í•œ ì¶”ì²œ ë„ì„œ:")
        for s in suggestions:
            st.markdown(f"<div class='card'>{s}</div>", unsafe_allow_html=True)

# ------------------------------
# ë©”ì¸ ì•±
# ------------------------------
st.title("ğŸ“–âœ¨ ë…ì„œ ì„±í–¥ ê¸°ë°˜ ì±… ì¶”ì²œ ì›¹ì•±")

menu = st.sidebar.radio("ë©”ë‰´ ì„ íƒ", ["ì„±í–¥ í…ŒìŠ¤íŠ¸", "ì¥ë¥´ë³„ ì¶”ì²œ", "ììœ  ì…ë ¥ ì¶”ì²œ"])

if menu == "ì„±í–¥ í…ŒìŠ¤íŠ¸":
    run_quiz()
elif menu == "ì¥ë¥´ë³„ ì¶”ì²œ":
    run_recommend_by_genre()
else:
    run_free_input()


import streamlit as st
from typing import Dict, List, Tuple
import random

st.set_page_config(page_title="ë…ì„œ ì„±í–¥ ê¸°ë°˜ ì±… ì¶”ì²œ", page_icon="ğŸ“š", layout="wide")

# ------------------------------
# â‘  ë°ì´í„° ì •ì˜
# ------------------------------
TYPES: Dict[str, str] = {
    "ê°ì„± ëª°ì…í˜•": "ëˆˆë¬¼ê³¼ ê°ë™ì„ ì¤‘ì‹œí•˜ë©° ì„œì •ì  ë¬¸ì¥ê³¼ ê´€ê³„ì˜ ë³€í™”ë¥¼ ì¢‹ì•„í•´ìš”.",
    "ì§€ì‹ íƒêµ¬í˜•": "ìƒˆë¡œìš´ ì‚¬ì‹¤ê³¼ ì´ë¡ ì„ í†µí•´ ì„¸ìƒì„ ì´í•´í•˜ê¸¸ ì›í•´ìš”.",
    "í˜„ì‹¤ ì ìš©í˜•": "ë°°ìš´ ê²ƒì„ ë°”ë¡œ ì‚¶ê³¼ ì¼ì— ì ìš©í•˜ëŠ” ê²ƒì„ ì„ í˜¸í•´ìš”.",
    "ìŠ¤í† ë¦¬ ëª°ì…í˜•": "ê°•ë ¬í•œ ì„œì‚¬, ìºë¦­í„° ì„±ì¥, ì‹œë¦¬ì¦ˆë¬¼ì— ê¹Šê²Œ ë¹ ì ¸ìš”.",
    "ì² í•™ ì‚¬ìƒ‰í˜•": "ê°€ì¹˜, ì¡´ì¬, ì‚¶ì˜ ì˜ë¯¸ë¥¼ ë¶™ì¡ê³  ì˜¤ë˜ ìƒê°í•´ìš”.",
    "íŠ¸ë Œë“œ ìºì²˜í˜•": "ìš”ì¦˜ í•«í•œ ì±…ê³¼ ì‹ ê°„ íë¦„ì„ ë¹¨ë¦¬ ìºì¹˜í•´ìš”.",
    "íë§ ë…ì„œí˜•": "ë§ˆìŒì„ ì–´ë£¨ë§Œì§€ëŠ” ë”°ëœ»í•œ ë¬¸ì¥ê³¼ ìœ„ë¡œë¥¼ ì°¾ì•„ìš”.",
    "ì‹¤í—˜ì  ë…ì„œí˜•": "í˜•ì‹/ì¥ë¥´ ì‹¤í—˜, ë‚¯ì„  ì‹œë„ì— í˜¸ê¸°ì‹¬ì´ ì»¤ìš”.",
    "ì‚¬íšŒ ì°¸ì—¬í˜•": "ì‚¬íšŒë¬¸ì œ/ì—­ì‚¬/ì‹œì‚¬ì— ê´€ì‹¬ì´ í¬ê³  í˜„ì‹¤ê³¼ í† ë¡ ì„ ì¦ê²¨ìš”.",
    "ê°€ë²¼ìš´ ì¦ê¹€í˜•": "ë¶€ë‹´ ì—†ì´ ì¬ë°Œê³  ìˆ ìˆ  ì½íˆëŠ” ì±…ì„ ì›í•´ìš”.",
}

# ê° ìœ í˜•ë³„ ì¶”ì²œ ì„œê°€(ìƒ˜í”Œ)
BOOKS: Dict[str, List[Dict]] = {
    "ê°ì„± ëª°ì…í˜•": [
        {"title": "ì•„ëª¬ë“œ", "author": "ì†ì›í‰", "reason": "ì„¬ì„¸í•œ ê°ì •ì„ ê³¼ ì„±ì¥."},
        {"title": "ì—°ì˜ í¸ì§€", "author": "ì¡°í˜„ì•„", "reason": "ì”ì”í•œ ìœ„ë¡œì™€ ìš¸ë¦¼."},
        {"title": "ì‘ë³„ì¸ì‚¬", "author": "ê¹€ì˜í•˜", "reason": "ë”°ëœ»í•¨ê³¼ ìƒì‹¤ì˜ ì—¬ìš´."},
        {"title": "ë¬´ë¡€í•œ ì‚¬ëŒì—ê²Œ ì›ƒìœ¼ë©° ëŒ€ì²˜í•˜ëŠ” ë²•", "author": "ì •ë¬¸ì •", "reason": "ë§ˆìŒ ê·¼ìœ¡ì„ ë‹¨ë‹¨í•˜ê²Œ."},
        {"title": "ë‹¬ëŸ¬êµ¬íŠ¸ ê¿ˆ ë°±í™”ì ", "author": "ì´ë¯¸ì˜ˆ", "reason": "ì•„ëŠ‘í•˜ê³  ëª½í™˜ì ì¸ ìœ„ë¡œ."},
    ],
    "ì§€ì‹ íƒêµ¬í˜•": [
        {"title": "ì´ê¸°ì  ìœ ì „ì", "author": "ë¦¬ì²˜ë“œ ë„í‚¨ìŠ¤", "reason": "ì§„í™”ë¡ ì˜ ì‹œê° í™•ëŒ€."},
        {"title": "ì½”ìŠ¤ëª¨ìŠ¤", "author": "ì¹¼ ì„¸ì´ê±´", "reason": "ìš°ì£¼ì™€ ì¸ê°„ì— ëŒ€í•œ ê²½ì´."},
        {"title": "ì‚¬í”¼ì—”ìŠ¤", "author": "ìœ ë°œ í•˜ë¼ë¦¬", "reason": "ì¸ë¥˜ì˜ ê±°ëŒ€í•œ ì„œì‚¬."},
        {"title": "ì´, ê· , ì‡ ", "author": "ì¬ë ˆë“œ ë‹¤ì´ì•„ëª¬ë“œ", "reason": "ë¬¸ëª…ì˜ ê²©ì°¨ë¥¼ í•´ë¶€."},
        {"title": "ìƒê°ì— ê´€í•œ ìƒê°", "author": "ëŒ€ë‹ˆì–¼ ì¹´ë„ˆë¨¼", "reason": "ì‚¬ê³  ì²´ê³„ì˜ ì´í•´."},
    ],
    "í˜„ì‹¤ ì ìš©í˜•": [
        {"title": "ì›ì”½", "author": "ê²Œë¦¬ ì¼ˆëŸ¬", "reason": "í•µì‹¬ì— ì§‘ì¤‘í•˜ëŠ” ë²•."},
        {"title": "ì•„ì£¼ ì‘ì€ ìŠµê´€ì˜ í˜", "author": "ì œì„ìŠ¤ í´ë¦¬ì–´", "reason": "ì‘ì€ ë³€í™”ì˜ ëˆ„ì ."},
        {"title": "í•˜ë²„ë“œ ìƒìœ„ 1%ì˜ ë¹„ë°€", "author": "ì •ì£¼ì˜", "reason": "ì‹¤ì „ ìƒì‚°ì„± íŒ."},
        {"title": "ë¦° ìŠ¤íƒ€íŠ¸ì—…", "author": "ì—ë¦­ ë¦¬ìŠ¤", "reason": "ì‚¬ì—…/í”„ë¡œì íŠ¸ ì‹¤í–‰."},
        {"title": "ì´ˆì§‘ì¤‘", "author": "ë‹ˆë¥´ ì—ì–„", "reason": "ì£¼ì˜ê´€ë¦¬ì™€ ì‹¤ì²œ."},
    ],
    "ìŠ¤í† ë¦¬ ëª°ì…í˜•": [
        {"title": "í•´ë¦¬ í¬í„°", "author": "J.K. ë¡¤ë§", "reason": "ì„±ì¥ê³¼ ìš°ì •, ëª¨í—˜."},
        {"title": "ë‚˜ë¯¸ì•¼ ì¡í™”ì ì˜ ê¸°ì ", "author": "íˆê°€ì‹œë…¸ ê²Œì´ê³ ", "reason": "ë”°ëœ»í•œ ì—°ê²°ì˜ ì„œì‚¬."},
        {"title": "ë¯¸ë“œë‚˜ì‡ ë¼ì´ë¸ŒëŸ¬ë¦¬", "author": "ë§¤íŠ¸ í—¤ì´ê·¸", "reason": "ë‹¤ì¤‘ ê°€ëŠ¥ì„±ì˜ ì´ì•¼ê¸°."},
        {"title": "ì¢…ì˜ ê¸°ì›", "author": "ì •ìœ ì •", "reason": "ëª°ì…ê° ìˆëŠ” ì „ê°œ."},
        {"title": "ë°”ëŒì˜ ì´ë¦„", "author": "íŒ¨íŠ¸ë¦­ ë¡œìŠ¤í¼ìŠ¤", "reason": "ì¥ëŒ€í•œ íŒíƒ€ì§€ ì„œì‚¬."},
    ],
    "ì² í•™ ì‚¬ìƒ‰í˜•": [
        {"title": "ë¬´ì—‡ì´ ì˜³ì€ê°€", "author": "ë§ˆì´í´ ìƒŒë¸", "reason": "ì •ì˜ì™€ ìœ¤ë¦¬ì˜ ì§ˆë¬¸."},
        {"title": "ë‹ˆì²´ì˜ ë§", "author": "ë‹ˆì‹œëª¨í†  ì¼„", "reason": "ì‚¬ìœ ì˜ ìê·¹."},
        {"title": "ì¡´ì¬ì˜ ì„¸ ê°€ì§€ ê±°ì§“ë§", "author": "ê¹€ì˜ë¯¼", "reason": "ì¼ìƒ ì† ì‚¬ìœ  í™•ì¥."},
        {"title": "ì² í•™ ì¹´í˜ì—ì„œ ë¬¸í•™ ì½ê¸°", "author": "íƒì„ì‚°", "reason": "ë¬¸í•™ì„ í†µí•œ ì„±ì°°."},
        {"title": "ì†Œí¬ë¼í…ŒìŠ¤ ìµìŠ¤í”„ë ˆìŠ¤", "author": "ì—ë¦­ ì™€ì´ë„ˆ", "reason": "ì—¬í–‰í•˜ëŠ” ì² í•™."},
    ],
    "íŠ¸ë Œë“œ ìºì²˜í˜•": [
        {"title": "ë¶ˆí¸í•œ í¸ì˜ì ", "author": "ê¹€í˜¸ì—°", "reason": "ëŒ€ì¤‘ì  ì¸ê¸°ì™€ ìš¸ë¦¼."},
        {"title": "í•˜ì–¼ë¹ˆ", "author": "ê¹€í›ˆ", "reason": "í™”ì œì„± ë†’ì€ ì„œì‚¬."},
        {"title": "íŒŒì¹œì½”", "author": "ì´ë¯¼ì§„", "reason": "ë“œë¼ë§ˆí‹±í•œ í™”ì œì‘."},
        {"title": "ì—­í–‰ì", "author": "ìì²­", "reason": "ì‹¤ì „ ìê¸°ê³„ë°œ í™”ì œ."},
        {"title": "ì•„ì£¼ í¬ë¯¸í•œ ë¹›ìœ¼ë¡œ", "author": "ì •ì„¸ë‘", "reason": "ìš”ì¦˜ ê°ì„±ì˜ ë¬¸ì¥."},
    ],
    "íë§ ë…ì„œí˜•": [
        {"title": "ì—¬í–‰ì˜ ì´ìœ ", "author": "ê¹€ì˜í•˜", "reason": "ì—¬ì • ì† ìœ„ë¡œ."},
        {"title": "ë³´ê±´êµì‚¬ ì•ˆì€ì˜", "author": "ì •ì„¸ë‘", "reason": "ê²½ì¾Œí•˜ê³  ìƒëƒ¥í•œ ì„¸ê³„."},
        {"title": "ì–¸ì–´ì˜ ì˜¨ë„", "author": "ì´ê¸°ì£¼", "reason": "ë”°ëœ»í•œ ë¬¸ì¥ë“¤."},
        {"title": "ìš°ë¦¬ê°€ ë¹›ì˜ ì†ë„ë¡œ ê°ˆ ìˆ˜ ì—†ë‹¤ë©´", "author": "ê¹€ì´ˆì—½", "reason": "ë‹¤ì •í•œ SFì˜ ìœ„ë¡œ."},
        {"title": "ì£½ê³  ì‹¶ì§€ë§Œ ë–¡ë³¶ì´ëŠ” ë¨¹ê³  ì‹¶ì–´", "author": "ë°±ì„¸í¬", "reason": "ì§„ì†”í•œ ê³µê°."},
    ],
    "ì‹¤í—˜ì  ë…ì„œí˜•": [
        {"title": "1Q84", "author": "ë¬´ë¼ì¹´ë¯¸ í•˜ë£¨í‚¤", "reason": "í˜•ì‹ê³¼ ì„¸ê³„ì˜ ë³€ì£¼."},
        {"title": "ê¸°ë‚˜ê¸´ í•˜ë£¨", "author": "ê°€ì¦ˆì˜¤ ì´ì‹œêµ¬ë¡œ", "reason": "ë¬¸ì²´ ì‹¤í—˜ê³¼ ì—¬ë°±."},
        {"title": "ë³´íŠ¸", "author": "ë‚¨ìˆ˜ì—°", "reason": "ë‚¯ì„  ì‹œì„ ì˜ ì„œì‚¬."},
        {"title": "ë§ë“¤ì˜ í’ê²½", "author": "ì´ë¬¸ì¬", "reason": "ì‹œì  ì´ë¯¸ì§€ì˜ ì‹¤í—˜."},
        {"title": "ì„¤êµ­", "author": "ê°€ì™€ë°”íƒ€ ì•¼ìŠ¤ë‚˜ë¦¬", "reason": "ì •ì œëœ ë¯¸í•™."},
    ],
    "ì‚¬íšŒ ì°¸ì—¬í˜•": [
        {"title": "íŒ©íŠ¸í’€ë‹ˆìŠ¤", "author": "í•œìŠ¤ ë¡œìŠ¬ë§", "reason": "ë°ì´í„°ë¡œ ë³´ëŠ” ì„¸ìƒ."},
        {"title": "ì•¼ì„±ì˜ ë¶€ë¥´ì§–ìŒ", "author": "ì¡°ë˜ í”¼í„°ìŠ¨", "reason": "ë…¼ìŸì  ì£¼ì œì˜ì‹."},
        {"title": "ìš°ë¦¬ëŠ” ì™œ ë¶„ë…¸í•˜ëŠ”ê°€", "author": "ë§ˆì‚¬ ëˆ„ìŠ¤ë°”ì›€", "reason": "ê°ì •ê³¼ ì •ì˜."},
        {"title": "ë‚œì¥ì´ê°€ ì˜ì•„ì˜¬ë¦° ì‘ì€ ê³µ", "author": "ì¡°ì„¸í¬", "reason": "ë¶ˆí‰ë“±ì˜ ê¸°ë¡."},
        {"title": "ëŒ€ë„ì‹œì˜ ì‚¬ë‘ë²•", "author": "ë°•ìƒì˜", "reason": "ë™ì‹œëŒ€ì˜ ëª©ì†Œë¦¬."},
    ],
    "ê°€ë²¼ìš´ ì¦ê¹€í˜•": [
        {"title": "ë‹¬ëŸ¬êµ¬íŠ¸ ê¿ˆ ë°±í™”ì  2", "author": "ì´ë¯¸ì˜ˆ", "reason": "í¸í•˜ê²Œ ì´ì–´ ì½ê¸°."},
        {"title": "ë¯¸ì›€ë°›ì„ ìš©ê¸° (ë§Œí™”íŒ)", "author": "ê¸°ì‹œë¯¸ ì´ì¹˜ë¡œ", "reason": "ì‰½ê³  ë¹ ë¥¸ ëª°ì…."},
        {"title": "ì–´ëŠ ë‚  ê³µì£¼ê°€ ë˜ì–´ë²„ë ¸ë‹¤", "author": "í”Œë£¨í† ", "reason": "ë¼ì´íŠ¸í•œ íŒíƒ€ì§€."},
        {"title": "ìµœì• ì˜ ì•„ì´ (ì½”ë¯¹ìŠ¤)", "author": "ì•„ì¹´ì‚¬ì¹´ ì•„ì¹´", "reason": "íŒí•˜ê³  ê°€ë²¼ì›€."},
        {"title": "ê¹€ë¹„ì„œê°€ ì™œ ê·¸ëŸ´ê¹Œ(ì†Œì„¤)", "author": "ì •ê²½ìœ¤", "reason": "ë“œë¼ë§ˆí‹± ë¡œë§¨ìŠ¤."},
    ],
}

# ì§ˆë¬¸ê³¼ ì ìˆ˜ ë§¤í•‘
QUESTIONS: List[Dict] = [
    {
        "text": "ì±…ì„ ì½ì„ ë•Œ ê°€ì¥ ê¸°ëŒ€í•˜ëŠ” ê±´ ë¬´ì—‡ì¸ê°€ìš”?",
        "options": {
            "ê°ë™": ["ê°ì„± ëª°ì…í˜•", "íë§ ë…ì„œí˜•"],
            "ì§€ì‹": ["ì§€ì‹ íƒêµ¬í˜•"],
            "ì‹¤ìš©ì„±": ["í˜„ì‹¤ ì ìš©í˜•"],
            "ì¬ë¯¸": ["ê°€ë²¼ìš´ ì¦ê¹€í˜•", "ìŠ¤í† ë¦¬ ëª°ì…í˜•"],
        },
    },
    {
        "text": "ë‹¤ ì½ê³  ë‚œ ë’¤ ì–´ë–¤ ê¸°ë¶„ì„ ì›í•˜ë‚˜ìš”?",
        "options": {
            "ìœ„ë¡œ": ["íë§ ë…ì„œí˜•", "ê°ì„± ëª°ì…í˜•"],
            "ë¿Œë“¯í•¨": ["í˜„ì‹¤ ì ìš©í˜•"],
            "ê¹¨ë‹¬ìŒ": ["ì§€ì‹ íƒêµ¬í˜•", "ì² í•™ ì‚¬ìƒ‰í˜•"],
            "ì—¬ìš´": ["ìŠ¤í† ë¦¬ ëª°ì…í˜•", "ì² í•™ ì‚¬ìƒ‰í˜•"],
        },
    },
    {
        "text": "ì–´ë–»ê²Œ ì±…ì„ ê³ ë¥´ë‚˜ìš”?",
        "options": {
            "ìœ í–‰/ë² ìŠ¤íŠ¸ì…€ëŸ¬": ["íŠ¸ë Œë“œ ìºì²˜í˜•"],
            "í•„ìš”ì— ë”°ë¼": ["í˜„ì‹¤ ì ìš©í˜•"],
            "ê°ì • ìƒíƒœì— ë”°ë¼": ["ê°ì„± ëª°ì…í˜•", "íë§ ë…ì„œí˜•"],
            "ê·¸ëƒ¥ ëŒë ¤ì„œ": ["ê°€ë²¼ìš´ ì¦ê¹€í˜•", "ì‹¤í—˜ì  ë…ì„œí˜•"],
        },
    },
    {
        "text": "ì„ í˜¸í•˜ëŠ” ê¸€ ìŠ¤íƒ€ì¼ì€?",
        "options": {
            "ì„œì •ì  ë¬¸ì¥": ["ê°ì„± ëª°ì…í˜•", "íë§ ë…ì„œí˜•"],
            "ê°„ê²°í•œ ì •ë³´": ["ì§€ì‹ íƒêµ¬í˜•", "í˜„ì‹¤ ì ìš©í˜•"],
            "ê°•ë ¬í•œ ì„œì‚¬": ["ìŠ¤í† ë¦¬ ëª°ì…í˜•", "íŠ¸ë Œë“œ ìºì²˜í˜•"],
            "ë‚¯ì„  ì‹¤í—˜": ["ì‹¤í—˜ì  ë…ì„œí˜•"],
        },
    },
    {
        "text": "ìš”ì¦˜ ë” ëŒë¦¬ëŠ” ì£¼ì œëŠ”?",
        "options": {
            "ì‚¶ì˜ ì˜ë¯¸": ["ì² í•™ ì‚¬ìƒ‰í˜•"],
            "ì‚¬íšŒ/ì—­ì‚¬": ["ì‚¬íšŒ ì°¸ì—¬í˜•"],
            "ì„±ì¥/ìê¸°ê´€ë¦¬": ["í˜„ì‹¤ ì ìš©í˜•"],
            "ìˆœìˆ˜í•œ ì¬ë¯¸": ["ê°€ë²¼ìš´ ì¦ê¹€í˜•", "ìŠ¤í† ë¦¬ ëª°ì…í˜•"],
        },
    },
]

# ------------------------------
# â‘¡ ìœ í‹¸ & ë¡œì§
# ------------------------------

def score_types(answers: List[str]) -> Dict[str, int]:
    score: Dict[str, int] = {t: 0 for t in TYPES}
    for a, q in zip(answers, QUESTIONS):
        for t in q["options"].get(a, []):
            score[t] += 1
    return score


def best_types(score: Dict[str, int], topk: int = 2) -> List[Tuple[str, int]]:
    ranked = sorted(score.items(), key=lambda x: (-x[1], x[0]))
    return ranked[:topk]


def recommend_by_types(top_types: List[str], k: int = 5) -> List[Dict]:
    picks: List[Dict] = []
    pool: List[Dict] = []
    for t in top_types:
        pool.extend(BOOKS.get(t, []))
    random.shuffle(pool)
    seen = set()
    for b in pool:
        key = (b["title"], b["author"]) 
        if key in seen:
            continue
        picks.append(b)
        seen.add(key)
        if len(picks) >= k:
            break
    # ë¶€ì¡±í•˜ë©´ ëª¨ë“  ì±…ì—ì„œ ì±„ì›€
    if len(picks) < k:
        others = sum(BOOKS.values(), [])
        random.shuffle(others)
        for b in others:
            key = (b["title"], b["author"]) 
            if key in seen:
                continue
            picks.append(b)
            seen.add(key)
            if len(picks) >= k:
                break
    return picks


def recommend_by_genre(genre_type: str, k: int = 5) -> List[Dict]:
    pool = BOOKS.get(genre_type, [])
    return random.sample(pool, k=min(k, len(pool))) if pool else []

# ------------------------------
# â‘¢ UI
# ------------------------------
with st.sidebar:
    st.title("ğŸ“š ë…ì„œ ì¶”ì²œ")
    menu = st.radio("ë©”ë‰´", ["í™ˆ", "ì„±í–¥ í…ŒìŠ¤íŠ¸", "ì¥ë¥´ë³„ ì¶”ì²œ", "ë‚´ ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜(ê°„ë‹¨)"])
    st.caption("í•œê¸€ 10ìœ í˜• ê¸°ë°˜ ë§ì¶¤ ì¶”ì²œ")

st.markdown("""
<style>
.small-note {font-size: 0.9rem; color: #666;}
.card {padding: 1rem; border: 1px solid #eee; border-radius: 1rem;}
</style>
""", unsafe_allow_html=True)

# í™ˆ
if menu == "í™ˆ":
    st.header("ë…ì„œ ì„±í–¥ ê¸°ë°˜ ì±… ì¶”ì²œ ì•±")
    st.write("ê°„ë‹¨í•œ ì„¤ë¬¸ìœ¼ë¡œ ë…ì„œ ì„±í–¥ì„ íŒŒì•…í•˜ê³ , ìœ í˜•ë³„ë¡œ ë§ì¶¤ ë„ì„œë¥¼ ì¶”ì²œí•´ ë“œë ¤ìš”.")

    cols = st.columns(3)
    with cols[0]:
        st.subheader("â‘  ì„±í–¥ í…ŒìŠ¤íŠ¸")
        st.write("5ë¬¸í•­ ì„¤ë¬¸ â†’ ìƒìœ„ 2ê°œ ìœ í˜• ë„ì¶œ â†’ ë§ì¶¤ ì¶”ì²œ")
    with cols[1]:
        st.subheader("â‘¡ ì¥ë¥´ë³„ ì¶”ì²œ")
        st.write("ì›í•˜ëŠ” ìœ í˜•(ì¥ë¥´ ê°ì„±)ì— ë§ëŠ” ì¶”ì²œ ë¦¬ìŠ¤íŠ¸")
    with cols[2]:
        st.subheader("â‘¢ ë‚´ ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜")
        st.write("ìµœê·¼ ì½ì€ ì±… í‚¤ì›Œë“œë¡œ ê°„ë‹¨ ì¶”ì²œ")

# ì„±í–¥ í…ŒìŠ¤íŠ¸
elif menu == "ì„±í–¥ í…ŒìŠ¤íŠ¸":
    st.header("ğŸ§­ ë…ì„œ ì„±í–¥ í…ŒìŠ¤íŠ¸")
    answers: List[str] = []
    for i, q in enumerate(QUESTIONS, 1):
        ans = st.radio(f"Q{i}. {q['text']}", list(q["options"].keys()), index=None)
        answers.append(ans if ans else "")

    if st.button("ê²°ê³¼ ë³´ê¸°", type="primary"):
        if any(a == "" for a in answers):
            st.warning("ëª¨ë“  ë¬¸í•­ì— ë‹µí•´ì£¼ì„¸ìš”.")
        else:
            s = score_types(answers)
            top2 = best_types(s, topk=2)
            top_names = [t for t, _ in top2]

            st.success("ë‹¹ì‹ ì˜ ë…ì„œ ìœ í˜•")
            cols = st.columns(len(top2))
            for col, (t, v) in zip(cols, top2):
                with col:
                    st.subheader(f"{t}")
                    st.caption(TYPES[t])
                    st.markdown(f"**ì ìˆ˜**: {v}")

            st.divider()
            st.subheader("ë§ì¶¤ ì¶”ì²œ")
            recs = recommend_by_types(top_names, k=6)
            for b in recs:
                st.markdown(
                    f"<div class='card'><b>{b['title']}</b> Â· {b['author']}<br><span class='small-note'>ì¶”ì²œ ì´ìœ : {b['reason']}</span></div>",
                    unsafe_allow_html=True,
                )

# ì¥ë¥´ë³„(ìœ í˜• ê°ì„±) ì¶”ì²œ
elif menu == "ì¥ë¥´ë³„ ì¶”ì²œ":
    st.header("ğŸ¯ ì¥ë¥´/ìœ í˜• ê°ì„±ìœ¼ë¡œ ì¶”ì²œ ë°›ê¸°")
    choice = st.selectbox("ì›í•˜ëŠ” ë¶„ìœ„ê¸°/ìœ í˜•ì„ ê³¨ë¼ì£¼ì„¸ìš”", list(TYPES.keys()))
    k = st.slider("ì¶”ì²œ ê°œìˆ˜", 3, 10, 5)
    if st.button("ì¶”ì²œ ë³´ê¸°"):
        recs = recommend_by_genre(choice, k=k)
        if not recs:
            st.info("í•´ë‹¹ ìœ í˜• ë°ì´í„°ê°€ ì•„ì§ ì—†ì–´ìš”. ë‹¤ë¥¸ ìœ í˜•ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.")
        for b in recs:
            st.markdown(
                f"<div class='card'><b>{b['title']}</b> Â· {b['author']}<br><span class='small-note'>ì¶”ì²œ ì´ìœ : {b['reason']}</span></div>",
                unsafe_allow_html=True,
            )

# ê°„ë‹¨: ë‚´ ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ ì¶”ì²œ(í‚¤ì›Œë“œ ë§¤ì¹­)
elif menu == "ë‚´ ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜(ê°„ë‹¨)":
    st.header("ğŸ“ ìµœê·¼ ì½ì€ ì±…/í‚¤ì›Œë“œ ê¸°ë°˜ ê°„ë‹¨ ì¶”ì²œ")
    user_text = st.text_area(
        "ìµœê·¼ ì½ì€ ì±… ì œëª©/í‚¤ì›Œë“œ(ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)",
        placeholder="ì˜ˆ) ë‹¬ëŸ¬êµ¬íŠ¸ ê¿ˆ ë°±í™”ì \nì—­í–‰ì\nì² í•™\nìœ„ë¡œ",
        height=150,
    )
    k = st.slider("ì¶”ì²œ ê°œìˆ˜", 3, 10, 5, key="mine_k")

    if st.button("ì¶”ì²œ ìƒì„±"):
        if not user_text.strip():
            st.warning("í•œ ì¤„ ì´ìƒ ì…ë ¥í•´ ì£¼ì„¸ìš”.")
        else:
            tokens = [t.strip().lower() for t in user_text.splitlines() if t.strip()]

            # ë§¤ìš° ë‹¨ìˆœí•œ í‚¤ì›Œë“œ â†’ ìœ í˜• ë§¤í•‘ ê·œì¹™
            key2type = {
                "ìœ„ë¡œ": "íë§ ë…ì„œí˜•",
                "ê°ë™": "ê°ì„± ëª°ì…í˜•",
                "ì² í•™": "ì² í•™ ì‚¬ìƒ‰í˜•",
                "ì‚¬íšŒ": "ì‚¬íšŒ ì°¸ì—¬í˜•",
                "ì—­ì‚¬": "ì‚¬íšŒ ì°¸ì—¬í˜•",
                "ë² ìŠ¤íŠ¸": "íŠ¸ë Œë“œ ìºì²˜í˜•",
                "ìœ í–‰": "íŠ¸ë Œë“œ ìºì²˜í˜•",
                "ì‹¤ìš©": "í˜„ì‹¤ ì ìš©í˜•",
                "ìê¸°ê³„ë°œ": "í˜„ì‹¤ ì ìš©í˜•",
                "ì •ë³´": "ì§€ì‹ íƒêµ¬í˜•",
                "ê³¼í•™": "ì§€ì‹ íƒêµ¬í˜•",
                "ì¬ë¯¸": "ê°€ë²¼ìš´ ì¦ê¹€í˜•",
                "ì†Œì„¤": "ìŠ¤í† ë¦¬ ëª°ì…í˜•",
                "ì‹œ": "ì‹¤í—˜ì  ë…ì„œí˜•",
            }

            votes = {t: 0 for t in TYPES}
            matched = []
            for tok in tokens:
                for kword, tname in key2type.items():
                    if kword in tok:
                        votes[tname] += 1
                        matched.append((tok, tname))

            # ìµœë‹¤ ë“í‘œ ìœ í˜• ì„ ì •(ë™ì  ì‹œ ì„ì˜)
            top = sorted(votes.items(), key=lambda x: (-x[1], x[0]))
            if top[0][1] == 0:
                st.info("í‚¤ì›Œë“œì—ì„œ ëšœë ·í•œ ì„±í–¥ì„ ì°¾ì§€ ëª»í–ˆì–´ìš”. ì „ì²´ì—ì„œ ê³¨ë¼ ë“œë¦´ê²Œìš”.")
                picks = recommend_by_types(list(TYPES.keys()), k=k)
            else:
                max_vote = top[0][1]
                candidates = [t for t, v in top if v == max_vote]
                chosen = random.choice(candidates)
                st.caption(f"í‚¤ì›Œë“œ ë§¤ì¹­ìœ¼ë¡œ ì„ íƒëœ ìœ í˜•: **{chosen}** (ë“í‘œ {max_vote})")
                if matched:
                    with st.expander("í‚¤ì›Œë“œ ë§¤ì¹­ ë¡œê·¸ ë³´ê¸°"):
                        for m in matched:
                            st.write("-", m[0], "â†’", m[1])
                picks = recommend_by_genre(chosen, k=k)

            st.subheader("ì¶”ì²œ ê²°ê³¼")
            for b in picks:
                st.markdown(
                    f"<div class='card'><b>{b['title']}</b> Â· {b['author']}<br><span class='small-note'>ì¶”ì²œ ì´ìœ : {b['reason']}</span></div>",
                    unsafe_allow_html=True,
                )

# í‘¸í„°
st.write("\n")
st.caption("â“’ ë…ì„œ ì„±í–¥ 10ìœ í˜• Â· Streamlit Demo Â· ë¡œì»¬ ë°ì´í„° ê¸°ë°˜ ì˜ˆì‹œ")
