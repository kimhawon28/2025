import streamlit as st
import requests

st.set_page_config(page_title="ì±…ê³¼ ì¹œí•´ì§€ê¸°", layout="centered")
st.title("ğŸ“š ì±…ê³¼ ì¹œí•´ì§€ê¸°")

# --- íƒ­ ìƒì„± ---
tab1, tab2 = st.tabs(["ë…ì„œ ì„±í–¥ í…ŒìŠ¤íŠ¸", "ë„ì„œ ê²€ìƒ‰"])

# --- íƒ­ 1: ë…ì„œ ì„±í–¥ í…ŒìŠ¤íŠ¸ ---
with tab1:
    st.header("ğŸ“‹ ë…ì„œ ì„±í–¥ í…ŒìŠ¤íŠ¸")
    st.write("ê° ì§ˆë¬¸ì—ì„œ ìì‹ ì—ê²Œ ê°€ê¹Œìš´ ì„ íƒì§€ë¥¼ ê³¨ë¼ì£¼ì„¸ìš”.")

    q1 = st.radio("1. ì±…ì„ ì½ì„ ë•Œ ë‚˜ëŠ”?", 
                  ["ê°ì •ì„ í¬ê²Œ ëŠë¼ëŠ” í¸ì´ë‹¤", "ì§€ì‹ì„ ì–»ëŠ” ê²ƒì´ ë” ì¢‹ë‹¤"])
    q2 = st.radio("2. ë‚˜ëŠ”?", 
                  ["ì² í•™ì ì´ê³  ì‚¬ìƒ‰ì ì¸ í¸", "ì‹¤ìš©ì ì´ê³  í˜„ì‹¤ì ì¸ í¸"])
    q3 = st.radio("3. ì±…ì„ ê³ ë¥¼ ë•Œ?", 
                  ["ë² ìŠ¤íŠ¸ì…€ëŸ¬/íŠ¸ë Œë“œë¥¼ ë³¸ë‹¤", "ë‚´ ì·¨í–¥ëŒ€ë¡œ ê³ ë¥¸ë‹¤"])
    q4 = st.radio("4. ë…ì„œ ëª©ì ì€?", 
                  ["ë§ˆìŒì„ ìœ„ë¡œë°›ê³  ì¹˜ìœ ", "ì§€ì‹ê³¼ ì •ë³´ ìŠµë“"])
    q5 = st.radio("5. ì„ í˜¸í•˜ëŠ” ì±… ìŠ¤íƒ€ì¼ì€?", 
                  ["ìŠ¤í† ë¦¬ ëª°ì…", "ì‹¤ìš©ì /ìê¸°ê³„ë°œ"])

    # --- ê²°ê³¼ ë²„íŠ¼ ---
    if st.button("ê²°ê³¼ ë³´ê¸°"):
        # ì ìˆ˜ ê³„ì‚°
        score = 0
        if q1 == "ê°ì •ì„ í¬ê²Œ ëŠë¼ëŠ” í¸ì´ë‹¤": score += 1
        else: score += 2
        if q2 == "ì² í•™ì ì´ê³  ì‚¬ìƒ‰ì ì¸ í¸": score += 1
        else: score += 2
        if q3 == "ë² ìŠ¤íŠ¸ì…€ëŸ¬/íŠ¸ë Œë“œë¥¼ ë³¸ë‹¤": score += 1
        else: score += 2
        if q4 == "ë§ˆìŒì„ ìœ„ë¡œë°›ê³  ì¹˜ìœ ": score += 1
        else: score += 2
        if q5 == "ìŠ¤í† ë¦¬ ëª°ì…, ì†Œì„¤": score += 1
        else: score += 2

        # ì„±í–¥ ë§¤í•‘
        if score <= 5:
            personality = "íë§ ë…ì„œí˜•"
        elif score == 6:
            personality = "ê°ì„± ëª°ì…í˜•"
        elif score == 7:
            personality = "ì² í•™ ì‚¬ìƒ‰í˜•"
        elif score == 8:
            personality = "ì‚¬íšŒ ì°¸ì—¬í˜•"
        elif score == 9:
            personality = "íŠ¸ë Œë“œ ìºì²˜í˜•"
        elif score == 10:
            personality = "í˜„ì‹¤ ì ìš©í˜•"
        elif score == 11:
            personality = "ì§€ì‹ íƒêµ¬í˜•"
        elif score == 12:
            personality = "ê°€ë²¼ìš´ ì¦ê¹€í˜•"
        elif score == 13:
            personality = "ìŠ¤í† ë¦¬ ëª°ì…í˜•"
        else:
            personality = "ì‹¤í—˜ì  ë…ì„œí˜•"

        descriptions = {
            "íë§ ë…ì„œí˜•": "ë§ˆìŒì„ ìœ„ë¡œë°›ê³  ì¹˜ìœ ë°›ëŠ” ë…ì„œë¥¼ ì„ í˜¸í•´ìš”.",
            "ê°ì„± ëª°ì…í˜•": "ê°ì •ì„ ìê·¹í•˜ëŠ” ë¬¸í•™ ì‘í’ˆì„ ì¦ê²¨ìš”.",
            "ì² í•™ ì‚¬ìƒ‰í˜•": "ê¹Šì€ ì‚¬ìœ ì™€ ì² í•™ì  í…ìŠ¤íŠ¸ë¥¼ íƒêµ¬í•´ìš”.",
            "ì‚¬íšŒ ì°¸ì—¬í˜•": "ì‚¬íšŒ ë¬¸ì œì™€ ì—­ì‚¬ì— ê´€ì‹¬ì´ ë§ì•„ìš”.",
            "íŠ¸ë Œë“œ ìºì²˜í˜•": "ë² ìŠ¤íŠ¸ì…€ëŸ¬ì™€ ìµœì‹  í™”ì œì‘ì„ ë”°ë¼ê°€ìš”.",
            "í˜„ì‹¤ ì ìš©í˜•": "ì‹¤ìš©ì ì´ê³  ìê¸°ê³„ë°œì— ë„ì›€ ë˜ëŠ” ì±…ì„ ì¢‹ì•„í•´ìš”.",
            "ì§€ì‹ íƒêµ¬í˜•": "ì •ë³´, ê³¼í•™, ì§€ì‹ì„ íƒêµ¬í•˜ëŠ” ë…ì„œê°€ ì¦ê±°ì›Œìš”.",
            "ê°€ë²¼ìš´ ì¦ê¹€í˜•": "ì¬ë¯¸ì™€ ì˜¤ë½ì„ ìœ„í•œ ê°€ë²¼ìš´ ì±…ì„ ì¦ê²¨ìš”.",
            "ìŠ¤í† ë¦¬ ëª°ì…í˜•": "ëª°ì…ê° ìˆëŠ” ì†Œì„¤ì„ ì„ í˜¸í•´ìš”.",
            "ì‹¤í—˜ì  ë…ì„œí˜•": "ì‹¤í—˜ì ì¸ í…ìŠ¤íŠ¸ì— ë§¤ë ¥ì„ ëŠê»´ìš”."
        }

        st.subheader(f"ğŸ”¹ ë‹¹ì‹ ì˜ ë…ì„œ ì„±í–¥  : {personality}")
        st.write(descriptions.get(personality, "ë‹¹ì‹ ì˜ ë…ì„œ ìŠ¤íƒ€ì¼ì„ ì°¾ëŠ” ì¤‘ì´ì—ìš”."))

        book_recommendations = {
            "íë§ ë…ì„œí˜•": ["ì–¸ì–´ì˜ ì˜¨ë„ (ë§ê³¼ ê¸€ì—ëŠ” ë‚˜ë¦„ì˜ ë”°ëœ»í•¨ê³¼ ì°¨ê°€ì›€ì´ ìˆë‹¤) - ì´ê¸°ì£¼", "ìš°ë¦¬ì˜ ë‚™ì›ì—ì„œ ë§Œë‚˜ì (ì´ ê³„ì ˆì„ í•¨ê»˜ ê±´ë„ˆëŠ” ë‹¹ì‹ ì—ê²Œ) - í•˜íƒœì™„", "ì—¬ë¦„ì„ í•œ ì… ë² ì–´ ë¬¼ì—ˆë”ë‹ˆ - ì´ê½ƒë‹˜"],
            "ê°ì„± ëª°ì…í˜•": ["ë…¸ë¥´ì›¨ì´ì˜ ìˆ² - ë¬´ë¼ì¹´ë¯¸ í•˜ë£¨í‚¤", "ì•ˆë…•ì´ë¼ ê·¸ë¬ì–´ - ê¹€ì• ë€", "ì²œ ê°œì˜ íŒŒë‘ - ì²œì„ ë€"],
            "ì² í•™ ì‚¬ìƒ‰í˜•": ["ì°¸ì„ ìˆ˜ ì—†ëŠ” ì¡´ì¬ì˜ ê°€ë²¼ì›€ - ë°€ë€ ì¿¤ë°ë¼", "ì‡¼íœí•˜ìš°ì–´ì˜ ì¸ìƒ ìˆ˜ì—… (ì‚´ì•„ê°ˆ í˜ì„ ì£¼ëŠ” ì‡¼íœí•˜ìš°ì–´ ì•„í¬ë¦¬ì¦˜) - ì‡¼íœí•˜ìš°ì–´", "ë°ë¯¸ì•ˆ - í—¤ë¥´ë§Œí—¤ì„¸"],
            "ì‚¬íšŒ ì°¸ì—¬í˜•": ["ë¹…í„° í”„ë­í´ì˜ ì£½ìŒì˜ ìˆ˜ìš©ì†Œì—ì„œ - ë¹…í„° í”„ë­í´", "í•˜ì–¼ë¹ˆ - ê¹€í›ˆ", "ë²•ê³¼ ì‚¬íšŒì™€ ì¸ê¶Œ - ì•ˆê²½í™˜"],
            "íŠ¸ë Œë“œ ìºì²˜í˜•": ["ëª¨ìˆœ - ì–‘ê·€ì", "ì²« ì—¬ë¦„ ì™„ì£¼ - ê¹€ê¸ˆí¬", "í˜¼ëª¨ë…¸ - ì„±í•´ë‚˜"],
            "í˜„ì‹¤ ì ìš©í˜•": ["ì›ì”½(The One Thing) (ë³µì¡í•œ ì„¸ìƒì„ ì´ê¸°ëŠ” ë‹¨ìˆœí•¨ì˜ í˜) - ê²Œë¦¬ ì¼ˆëŸ¬, ì œì´ íŒŒíŒŒì‚°", "ë§ ê·¸ë¦‡ (ë¹„ìš¸ìˆ˜ë¡ ì‚¬ëŒì„ ë” ì±„ìš°ëŠ”) - ê¹€ìœ¤ë‚˜", "í“¨ì²˜ ì…€í”„ (í˜„ì¬ì™€ ë¯¸ë˜ê°€ ë‹¬ë¼ì§€ëŠ” ë†€ë¼ìš´ í˜ëª…) - ë²¤ì €ë¯¼ í•˜ë””"],
            "ì§€ì‹ íƒêµ¬í˜•": ["ë„›ì§€ (ë³µì¡í•œ ì„¸ìƒì—ì„œ ë˜‘ë˜‘í•œ ì„ íƒì„ ì´ë„ëŠ” í˜) - ë¦¬ì²˜ë“œ íƒˆëŸ¬, ìºìŠ¤ ì„ ìŠ¤íƒ€ì¸", "ì´ ê·  ì‡  - ì¬ë ˆë“œ ë‹¤ì´ì•„ëª¬ë“œ", "ì½”ìŠ¤ëª¨ìŠ¤ - ì¹¼ ì„¸ì´ê±´"],
            "ê°€ë²¼ìš´ ì¦ê¹€í˜•": ["ê¸¸ëª¨í‰ì´ì—ì„œ ë§Œë‚œ ì‚¬ëŒ - ì–‘ê·€ì", "ì‚¬ì„œí•¨ 110í˜¸ì˜ ìš°í¸ë¬¼ - ì´ë™ìš°", "ì™¸ê³„ì¸ì´ ì¸ë¥˜ë¥¼ ë©¸ë§ì‹œí‚¨ëŒ€ - ë°•ëŒ€ê²¸"],
            "ìŠ¤í† ë¦¬ ëª°ì…í˜•": ["íŒŒê³¼ - êµ¬ë³‘ëª¨", "ë‚˜ëŠ” ì†Œë§í•œë‹¤ ë‚´ê²Œ ê¸ˆì§€ëœ ê²ƒì„ - ì–‘ê·€ì", "ê´‘ì¸ - ì´í˜ì§„"],
            "ì‹¤í—˜ì  ë…ì„œí˜•": ["êµ¬ì˜ ì¦ëª…  - ìµœì§„ì˜", "ì‚¼ë¯¸ ìŠˆí¼ìŠ¤íƒ€ì¦ˆì˜ ë§ˆì§€ë§‰ íŒ¬í´ëŸ½ - ë°•ë¯¼ê·œ", "ì¼ì¸ìš© ì±… - ì‹ í•´ìš±"]
        }

        st.subheader("ğŸ“– ì¶”ì²œ ë„ì„œ")
        for b in book_recommendations[personality]:
            st.write(f"- {b}")

# --- íƒ­ 2: ë„ì„œ ê²€ìƒ‰ ---
with tab2:
    st.header("ğŸ” ë„ì„œ ê²€ìƒ‰")
    keyword = st.text_input("ê²€ìƒ‰ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì†Œì„¤, ìê¸°ê³„ë°œ, ê²½ì œ)")
    
if keyword:
    url = "https://openapi.naver.com/v1/search/book.json"
    headers = {
        "X-Naver-Client-Id": "ZpjV3RrEyIOBNZ0CkqPM",        # ğŸ”‘ ë°œê¸‰ë°›ì€ Client ID
        "X-Naver-Client-Secret": "Yv857utsaI" # ğŸ”‘ ë°œê¸‰ë°›ì€ Client Secret
    }
    params = {"query": keyword, "display": 10}  # ìµœëŒ€ 10ê¶Œ ì¶”ì²œ

    response = requests.get(url, headers=headers, params=params)

    if response.status_code == 200:
        books = response.json()["items"]

        if len(books) > 0:
            for book in books:
                st.image(book["image"], width=120)  # ì±… í‘œì§€
                # <b>íƒœê·¸ ì œê±°
                title = book["title"].replace("<b>", "").replace("</b>", "")
                st.subheader(title)
                st.write(f"ì €ì: {book['author']}")
                st.write(f"ì¶œíŒì‚¬: {book['publisher']}")
                st.write(f"ì¶œíŒì¼: {book['pubdate']}")
                st.write(f"[ìƒì„¸ë³´ê¸°]({book['link']})")
                st.markdown("---")
        else:
            st.write("ğŸ˜¥ ê´€ë ¨ ë„ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
    else:
        st.error("API ìš”ì²­ ì‹¤íŒ¨. Client ID/Secretì„ í™•ì¸í•˜ì„¸ìš”.")
