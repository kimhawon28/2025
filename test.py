import streamlit as st
import requests

st.set_page_config(page_title="ë…ì„œ ì„±í–¥ í…ŒìŠ¤íŠ¸ & ë„ì„œ ê²€ìƒ‰", layout="centered")
st.title("ğŸ“š ì±…ê³¼ ì¹œí•´ì§€ê¸°")

# --- íƒ­ ìƒì„± ---
tab1, tab2 = st.tabs(["ë…ì„œ ì„±í–¥ í…ŒìŠ¤íŠ¸", "ë„ì„œ ê²€ìƒ‰"])

# --- íƒ­ 1: ë…ì„œ ì„±í–¥ í…ŒìŠ¤íŠ¸ ---
with tab1:
    st.header("ğŸ“‹ ë…ì„œ ì„±í–¥ í…ŒìŠ¤íŠ¸")
    st.write("ê° ì§ˆë¬¸ì—ì„œ ìì‹ ì—ê²Œ ê°€ê¹Œìš´ ì„ íƒì§€ë¥¼ ê³¨ë¼ì£¼ì„¸ìš”.")

    q1 = st.radio("1. ì±…ì„ ì½ì„ ë•Œ ë‚˜ëŠ”?", 
                  ["ê°ì •ì„ í¬ê²Œ ëŠë¼ëŠ” í¸ì´ë‹¤", "ì§€ì‹ì„ ì–»ëŠ” ê²ƒì´ ë” ì¢‹ë‹¤"])
    q2 = st.radio("2. ë‚˜ëŠ”?", 
                  ["ì² í•™ì ì´ê³  ì‚¬ìƒ‰ì ì¸ í¸", "ì‹¤ìš©ì ì´ê³  í˜„ì‹¤ì ì¸ í¸"])
    q3 = st.radio("3. ì±…ì„ ê³ ë¥¼ ë•Œ?", 
                  ["ë² ìŠ¤íŠ¸ì…€ëŸ¬/íŠ¸ë Œë“œë¥¼ ë³¸ë‹¤", "ë‚´ ì·¨í–¥ëŒ€ë¡œ ê³ ë¥¸ë‹¤"])
    q4 = st.radio("4. ë…ì„œ ëª©ì ì€?", 
                  ["ë§ˆìŒì„ ìœ„ë¡œë°›ê³  ì¹˜ìœ ", "ì§€ì‹ê³¼ ì •ë³´ ìŠµë“"])
    q5 = st.radio("5. ì„ í˜¸í•˜ëŠ” ì±… ìŠ¤íƒ€ì¼ì€?", 
                  ["ìŠ¤í† ë¦¬ ëª°ì…", "ì‹¤ìš©ì /ìê¸°ê³„ë°œ"])

    # --- ê²°ê³¼ ë²„íŠ¼ ---
    if st.button("ê²°ê³¼ ë³´ê¸°"):
        # ì ìˆ˜ ê³„ì‚°
        score = 0
        if q1 == "ê°ì •ì„ í¬ê²Œ ëŠë¼ëŠ” í¸ì´ë‹¤": score += 1
        else: score += 2
        if q2 == "ì² í•™ì ì´ê³  ì‚¬ìƒ‰ì ì¸ í¸": score += 1
        else: score += 2
        if q3 == "ë² ìŠ¤íŠ¸ì…€ëŸ¬/íŠ¸ë Œë“œë¥¼ ë³¸ë‹¤": score += 1
        else: score += 2
        if q4 == "ë§ˆìŒì„ ìœ„ë¡œë°›ê³  ì¹˜ìœ ": score += 1
        else: score += 2
        if q5 == "ìŠ¤í† ë¦¬ ëª°ì…, ì†Œì„¤": score += 1
        else: score += 2

        # ì„±í–¥ ë§¤í•‘
        if score <= 5:
            personality = "íë§ ë…ì„œí˜•"
        elif score == 6:
            personality = "ê°ì„± ëª°ì…í˜•"
        elif score == 7:
            personality = "ì² í•™ ì‚¬ìƒ‰í˜•"
        elif score == 8:
            personality = "ì‚¬íšŒ ì°¸ì—¬í˜•"
        elif score == 9:
            personality = "íŠ¸ë Œë“œ ìºì²˜í˜•"
        elif score == 10:
            personality = "í˜„ì‹¤ ì ìš©í˜•"
        elif score == 11:
            personality = "ì§€ì‹ íƒêµ¬í˜•"
        elif score == 12:
            personality = "ê°€ë²¼ìš´ ì¦ê¹€í˜•"
        elif score == 13:
            personality = "ìŠ¤í† ë¦¬ ëª°ì…í˜•"
        else:
            personality = "ì‹¤í—˜ì  ë…ì„œí˜•"

        descriptions = {
            "íë§ ë…ì„œí˜•": "ë§ˆìŒì„ ìœ„ë¡œë°›ê³  ì¹˜ìœ ë°›ëŠ” ë…ì„œë¥¼ ì„ í˜¸í•´ìš”.",
            "ê°ì„± ëª°ì…í˜•": "ê°ì •ì„ ìê·¹í•˜ëŠ” ë¬¸í•™ ì‘í’ˆì„ ì¦ê²¨ìš”.",
            "ì² í•™ ì‚¬ìƒ‰í˜•": "ê¹Šì€ ì‚¬ìœ ì™€ ì² í•™ì  í…ìŠ¤íŠ¸ë¥¼ íƒêµ¬í•´ìš”.",
            "ì‚¬íšŒ ì°¸ì—¬í˜•": "ì‚¬íšŒ ë¬¸ì œì™€ ì—­ì‚¬ì— ê´€ì‹¬ì´ ë§ì•„ìš”.",
            "íŠ¸ë Œë“œ ìºì²˜í˜•": "ë² ìŠ¤íŠ¸ì…€ëŸ¬ì™€ ìµœì‹  í™”ì œì‘ì„ ë”°ë¼ê°€ìš”.",
            "í˜„ì‹¤ ì ìš©í˜•": "ì‹¤ìš©ì ì´ê³  ìê¸°ê³„ë°œì— ë„ì›€ ë˜ëŠ” ì±…ì„ ì¢‹ì•„í•´ìš”.",
            "ì§€ì‹ íƒêµ¬í˜•": "ì •ë³´, ê³¼í•™, ì§€ì‹ì„ íƒêµ¬í•˜ëŠ” ë…ì„œê°€ ì¦ê±°ì›Œìš”.",
            "ê°€ë²¼ìš´ ì¦ê¹€í˜•": "ì¬ë¯¸ì™€ ì˜¤ë½ì„ ìœ„í•œ ê°€ë²¼ìš´ ì±…ì„ ì¦ê²¨ìš”.",
            "ìŠ¤í† ë¦¬ ëª°ì…í˜•": "ëª°ì…ê° ìˆëŠ” ì†Œì„¤ì„ ì„ í˜¸í•´ìš”.",
            "ì‹¤í—˜ì  ë…ì„œí˜•": "ì‹¤í—˜ì ì¸ í…ìŠ¤íŠ¸ì— ë§¤ë ¥ì„ ëŠê»´ìš”."
        }

        st.subheader(f"ğŸ”¹ ë‹¹ì‹ ì˜ ë…ì„œ ì„±í–¥: {personality}")
        st.write(descriptions.get(personality, "ë‹¹ì‹ ì˜ ë…ì„œ ìŠ¤íƒ€ì¼ì„ ì°¾ëŠ” ì¤‘ì´ì—ìš”."))

        book_recommendations = {
            "íë§ ë…ì„œí˜•": ["ì±…1", "ì±…2", "ì±…3"],
            "ê°ì„± ëª°ì…í˜•": ["ì±…4", "ì±…5", "ì±…6"],
            "ì² í•™ ì‚¬ìƒ‰í˜•": ["ì±…7", "ì±…8", "ì±…9"],
            "ì‚¬íšŒ ì°¸ì—¬í˜•": ["ì±…10", "ì±…11", "ì±…12"],
            "íŠ¸ë Œë“œ ìºì²˜í˜•": ["ì±…13", "ì±…14", "ì±…15"],
            "í˜„ì‹¤ ì ìš©í˜•": ["ì±…16", "ì±…17", "ì±…18"],
            "ì§€ì‹ íƒêµ¬í˜•": ["ì±…19", "ì±…20", "ì±…21"],
            "ê°€ë²¼ìš´ ì¦ê¹€í˜•": ["ì±…22", "ì±…23", "ì±…24"],
            "ìŠ¤í† ë¦¬ ëª°ì…í˜•": ["ì±…25", "ì±…26", "ì±…27"],
            "ì‹¤í—˜ì  ë…ì„œí˜•": ["ì±…28", "ì±…29", "ì±…30"]
        }

        st.subheader("ğŸ“– ì¶”ì²œ ë„ì„œ")
        for b in book_recommendations[personality]:
            st.write(f"- {b}")

# --- íƒ­ 2: ë„ì„œ ê²€ìƒ‰ ---
with tab2:
    st.header("ğŸ” ë„ì„œ ê²€ìƒ‰")
    keyword = st.text_input("ê²€ìƒ‰ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì†Œì„¤, ìê¸°ê³„ë°œ, ê²½ì œ)")
    
if keyword:
    url = "https://openapi.naver.com/v1/search/book.json"
    headers = {
        "X-Naver-Client-Id": "ZpjV3RrEyIOBNZ0CkqPM",        # ğŸ”‘ ë°œê¸‰ë°›ì€ Client ID
        "X-Naver-Client-Secret": "Yv857utsaI" # ğŸ”‘ ë°œê¸‰ë°›ì€ Client Secret
    }
    params = {"query": keyword, "display": 10}  # ìµœëŒ€ 10ê¶Œ ì¶”ì²œ

    response = requests.get(url, headers=headers, params=params)

    if response.status_code == 200:
        books = response.json()["items"]

        if len(books) > 0:
            for book in books:
                st.image(book["image"], width=120)  # ì±… í‘œì§€
                # <b>íƒœê·¸ ì œê±°
                title = book["title"].replace("<b>", "").replace("</b>", "")
                st.subheader(title)
                st.write(f"ì €ì: {book['author']}")
                st.write(f"ì¶œíŒì‚¬: {book['publisher']}")
                st.write(f"ì¶œíŒì¼: {book['pubdate']}")
                st.write(f"[ìƒì„¸ë³´ê¸°]({book['link']})")
                st.markdown("---")
        else:
            st.write("ğŸ˜¥ ê´€ë ¨ ë„ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
    else:
        st.error("API ìš”ì²­ ì‹¤íŒ¨. Client ID/Secretì„ í™•ì¸í•˜ì„¸ìš”.")
